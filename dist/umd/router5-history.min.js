!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define("router5HistoryPlugin",e):t.router5HistoryPlugin=e()}(this,function(){"use strict";var t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},e=function(t){return function(){return t}},n=function(){},a="undefined"!=typeof window,o=function(){return window.location.pathname.replace(/\/$/,"")},r=function(t,e,n){return window.history.pushState(t,e,n)},i=function(t,e,n){return window.history.replaceState(t,e,n)},s=function(t){return window.addEventListener("popstate",t)},u=function(t){return window.removeEventListener("popstate",t)},c=function(t){var e=t.useHash?window.location.hash.replace(new RegExp("^#"+t.hashPrefix),""):window.location.pathname.replace(new RegExp("^"+t.base),"");return e+window.location.search},p={};p=a?{getBase:o,pushState:r,replaceState:i,addPopstateListener:s,removePopstateListener:u,getLocation:c}:{getBase:e(""),pushState:n,replaceState:n,addPopstateListener:n,removePopstateListener:n,getLocation:e("")};var f=p,l=f.pushState,d=f.replaceState,w=f.addPopstateListener,h=f.removePopstateListener,v=f.getLocation,m=f.getBase,S="HISTORY",g=function(){return function(e){e.getLocation=function(){return v(e.options)};var n=function(t,e,n){n?d(t,"",e):l(t,"",e)},a=function(a){var o=!a.state||!a.state.name,r=o?e.matchPath(v(e.options)):a.state,i=e.options,s=i.defaultRoute,u=i.defaultParams;if(!r)return void e.navigate(s,u,{reload:!0,replace:!0});if(!e.lastKnownState||!e.areStatesEqual(r,e.lastKnownState,!0)){var c=t({},e.getState());e._transition(r,c,function(t,a){if(t)if("CANNOT_DEACTIVATE"===t){var i=e.buildUrl(e.lastKnownState.name,e.lastKnownState.params);o||n(r,i,!0)}else e.navigate(s,u,{reload:!0,replace:!0});else e._invokeListeners("$$success",a,c,{replace:!0})})}},o=function(){e.options.useHash&&!e.options.base&&(e.options.base=m()),w(a)},r=function(){h(a)},i=function(t,a,o){n(t,e.buildUrl(t.name,t.params),o.replace||o.reload)};return{name:S,onStart:o,onStop:r,onTransitionSuccess:i,onPopState:a}}};return g});